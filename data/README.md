# /data — Данные и промпты

## Что здесь находится

Статические данные проекта:

- **scenario.json** — полный сценарий квеста (персонажи, секреты, улики)
- **prompts/** — текстовые промпты для AI

### /prompts
- **anna-base.txt** — базовый промпт для персонажа Анны
- **boris-base.txt** — базовый промпт для персонажа Бориса
- **viktor-base.txt** — базовый промпт для персонажа Виктора
- **analyzer.txt** — промпт для анализа сообщений игрока

## Что нужно сделать

### scenario.json
- [ ] Структура данных для всего квеста
- [ ] Информация о 3 персонажах:
  - Имя, возраст, должность
  - Бэкграунд
  - Начальное доверие
  - Секреты (уровни 1, 2, 3)
  - Триггеры блокировки
- [ ] Список всех улик
- [ ] Правильный ответ (кто убийца)

**Примерная структура:**
```json
{
  "characters": [
    {
      "id": "anna",
      "name": "Анна Соколова",
      "age": 28,
      "role": "Секретарь директора",
      "initialTrust": 50,
      "background": "Выросла в детском доме...",
      "secrets": {
        "level1": [
          {
            "id": "anna_secret_1",
            "trustRequired": 30,
            "text": "Видела Виктора выходящим из кабинета ~23:00"
          }
        ],
        "level2": [...],
        "level3": [...]
      },
      "blockTriggers": [
        "обвинение в романе без доказательств",
        "упоминание детского дома негативно"
      ]
    }
  ],
  "evidence": [
    {
      "id": "evidence_1",
      "title": "Виктор в кабинете",
      "description": "Анна видела Виктора выходящим из кабинета в 23:00",
      "source": "anna",
      "relevantTo": ["viktor"]
    }
  ],
  "solution": {
    "murderer": "viktor",
    "requiredEvidence": ["evidence_1", "evidence_5", "evidence_8"]
  }
}
```

### prompts/anna-base.txt
- [ ] Полный промпт для персонажа Анны
- [ ] Бэкграунд и характер
- [ ] Стиль речи
- [ ] Все секреты по уровням доверия
- [ ] Инструкции как реагировать на эмоции
- [ ] Placeholder'ы: `{trust}`, `{emotion}`, `{revealedSecrets}`, `{conversationHistory}`

**Формат:**
```
Ты Анна Соколова, 28 лет, секретарь директора IT-компании "НейроТех".

БЭКГРАУНД:
Выросла в детском доме. Никогда не знала родителей...

ХАРАКТЕР:
- Нервная, неуверенная в себе
- Избегаешь зрительного контакта когда врёшь
...

СЕКРЕТЫ (раскрываешь только если доверие достигнуто):
УРОВЕНЬ 1 (trust >= 30):
- Видела Виктора выходящим из кабинета...

ТЕКУЩЕЕ СОСТОЯНИЕ:
- Доверие к игроку: {trust}
- Эмоция: {emotion}
- Раскрытые секреты: {revealedSecrets}

ПОСЛЕДНИЕ РЕПЛИКИ:
{conversationHistory}

СООБЩЕНИЕ ИГРОКА: "{playerMessage}"

ИНСТРУКЦИЯ:
Ответь В ХАРАКТЕРЕ Анны, учитывая эмоцию и доверие...
```

### prompts/boris-base.txt
- [ ] Аналогично для Бориса
- [ ] Военный стиль речи
- [ ] Его секреты и триггеры

### prompts/viktor-base.txt
- [ ] Аналогично для Виктора
- [ ] Харизматичный стиль
- [ ] Его секреты (включая признание убийства на trust 85+)

### prompts/analyzer.txt
- [ ] Промпт для анализа сообщения игрока
- [ ] Правила оценки тональности
- [ ] Модификаторы доверия (-30 до +20)
- [ ] Определение эмоций
- [ ] Проверка триггеров блокировки
- [ ] JSON формат ответа

**Формат:**
```
Ты анализируешь сообщение игрока к персонажу {characterName}.

ПЕРСОНАЖ: {characterBio}
ТЕКУЩЕЕ ДОВЕРИЕ: {currentTrust}
ТЕКУЩАЯ ЭМОЦИЯ: {currentEmotion}

СООБЩЕНИЕ ИГРОКА: "{playerMessage}"

ЗАДАЧА: Проанализируй тон, содержание, подход игрока.

Верни ТОЛЬКО JSON:
{
  "trustChange": <-30 до +20>,
  "newEmotion": "<anger|sad|fearful|defensive|openness|neutral|suspicious>",
  "triggerBlock": <true|false>,
  "detectedTopics": ["тема1", "тема2"],
  "shouldRevealSecret": "<id секрета или null>",
  "reasoning": "краткое объяснение"
}

ПРАВИЛА:
- Грубость: -20 до -25
- Обвинения: -25 до -30
- Сочувствие: +10 до +15
...
```

## Связь с другими модулями

- Промпты загружаются через `/lib/prompts.ts`
- `scenario.json` используется для инициализации БД (seed data)
- AI клиент (`/lib/ai-client.ts`) форматирует и отправляет промпты

## Важно для Haiku

1. Начни с **scenario.json** — структура данных всего квеста
2. Потом **analyzer.txt** — он общий для всех персонажей
3. Затем промпты персонажей: **anna-base.txt**, **boris-base.txt**, **viktor-base.txt**

**Копируй текст из главного README** — вся информация о персонажах уже есть в `quest-messenger-README.md`!

## Тестирование промптов

Используй Open Router Playground для тестирования:
1. Иди на https://openrouter.ai/playground
2. Вставь промпт с примерными данными
3. Проверь что AI отвечает в характере
4. Поправь промпт если нужно
